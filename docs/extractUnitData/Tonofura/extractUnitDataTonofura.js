"use strict";function d(t,e,r){let i=0;for(let n=e+1;n<t.length;n++)if(!t[n].trim().startsWith("//")&&t[n].trim()!=""&&(i++,i===r))return t[n];return""}function x(t){return t.replace(/&color\([^)]*\)\{([^}]*)\};/g,"$1")}function b(t,e,r){let i=t.split("|"),n=parseFloat(i[r]);console.log("attack:"+n);let a=new RegExp(`${e}(\\d+)%`,"g");for(let s=r;s<i.length;s++)i[s]=i[s].replaceAll(a,(m,h)=>{let T=n*parseFloat(h)/100;return`${e}${h}%(${Math.round(T)})`});return i.join("|")}function p(t,e="",r,i){let n=t.split(`
`),a=r;D(n,i,a);let s=a.toCsvRow();return e.includes(s)?e:e+s+`
`}function D(t,e,r){for(let i=0;i<t.length;i++){let n=t[i];if(!n.trim().startsWith("//")){for(let a of e)if(n.includes(a.match)){let s=d(t,i,a.offset);if(s){s=s.replace(/(\|\>)+/g,"|"),s=s.replace(/(\|~)+/g,"|"),s=s.replace(/(\|\|)+/g,"|");let m=a.transform?a.transform(s):s;a.assign(r,m)}}}}}var c=class{constructor(){this.name="",this.element="",this.rarity="",this.gacha="",this.atk=0,this.implementationDate="",this.skill="",this.ability1="",this.ability2="",this.supportAbility="",this.awakenOrTrustAbility=""}getIcon(){return`&ref(img/${this.name}_icon.png,80x80);`}toCsvRow(){let e=`|${this.getIcon()}|[[${this.name}]]|${this.element}|${this.gacha}&br;${this.implementationDate}|${this.atk}|${this.skill}|${this.ability1}|${this.ability2}|${this.supportAbility}|`;return this.rarity.includes("SSR")&&(e+=`${this.awakenOrTrustAbility}|`),e=x(e),e=e.replaceAll(" ",""),e=e.replaceAll("\uFF05","%"),e=e.replaceAll("\u3001&br;","\u3001"),e=e.replaceAll("\u30BF\u30FC\u30F3&br;","\u30BF\u30FC\u30F3"),e=b(e,"ATK",5),e}fromCsvRow(e){let r=e.split("|");this.name=r[2]?.trim(),this.element=r[3]?.trim(),this.gacha=r[4]?.split("&br;")[0]?.trim()??"",this.implementationDate=r[4]?.split("&br;")[1]?.trim()??"",this.atk=parseInt(r[5]?.trim(),10)||0,this.skill=r[6]?.trim(),this.ability1=r[7]?.trim(),this.ability2=r[8]?.trim(),this.supportAbility=r[9]?.trim(),this.awakenOrTrustAbility=r[10]?.trim()}};var f=[{match:"|~\u540D\u524D|~\u30EC\u30A2|",offset:1,transform:t=>t,assign:(t,e)=>{let r=e.split("|"),i=r[1]?.trim(),n=r[2]?.trim(),a=r[3]?.trim().replace(/（/g,"(").replace(/）/g,")");t.name=i,t.rarity=n,t.element=a,t.gacha=n?.includes("SSR")?"\u6052\u5E38/\u671F\u9593\u9650\u5B9A/\u30A2\u30CB\u30D0/\u30A2\u30CA\u30B6\u30FC/\u30B3\u30E9\u30DC":"\u6052\u5E38/\u30A4\u30D9\u30F3\u30C8\uFF08\u7570\u5178\uFF09"}},{match:"|~|~|~|~HP|",offset:1,transform:t=>t,assign:(t,e)=>{let r=e.split("|");t.atk=parseInt(r[3]?.trim(),10)||0}},{match:"|>|>|~\u5165\u624B\u65B9\u6CD5|",offset:1,transform:t=>t,assign:(t,e)=>{let i=e.split("|")[1]?.match(/(\d{4}\.\d{1,2}\.\d{1,2})/);t.implementationDate=i?i[1]:""}},{match:"**\u30B9\u30AD\u30EB",offset:3,transform:t=>t,assign:(t,e)=>t.skill=e.replace(/\|/g,"")},{match:"**\u30A2\u30D3\u30EA\u30C6\u30A31",offset:3,transform:t=>t,assign:(t,e)=>t.ability1=e.replace(/\|/g,"")},{match:"**\u30A2\u30D3\u30EA\u30C6\u30A32",offset:3,transform:t=>t,assign:(t,e)=>t.ability2=e.replace(/\|/g,"")},{match:"**\u30B5\u30DD\u30FC\u30C8\u30A2\u30D3\u30EA\u30C6\u30A3",offset:3,transform:t=>t,assign:(t,e)=>t.supportAbility=e.replace(/\|/g,"")},{match:"**\u30C8\u30E9\u30B9\u30C8\u30A2\u30D3\u30EA\u30C6\u30A3",offset:3,transform:t=>t,assign:(t,e)=>t.awakenOrTrustAbility="\uFF3B\u30C8\u30E9\u30B9\u30C8\uFF3D&br;"+e.replace(/\|/g,"")},{match:"**\u899A\u9192\u30A2\u30D3\u30EA\u30C6\u30A3",offset:3,transform:t=>t,assign:(t,e)=>{t.awakenOrTrustAbility?t.awakenOrTrustAbility+="&br;"+e.replace(/\|/g,""):t.awakenOrTrustAbility=e.replace(/\|/g,"")}}];var u=class{constructor(){this.homeUrl="https://tonofura.wikiru.jp/?",this.editPage="cmd=edit&page=",this.skillAbilityPage="\u30B9\u30AD\u30EB\u52B9\u679C\u5225\u4E00\u89A7",this.skillAbilitySsrList="\u30C6\u30FC\u30D6\u30EB/\u30B9\u30AD\u30EB\u30FB\u30A2\u30D3\u30EA\u30C6\u30A3/SSR",this.skillAbilitySrList="\u30C6\u30FC\u30D6\u30EB/\u30B9\u30AD\u30EB\u30FB\u30A2\u30D3\u30EA\u30C6\u30A3/SR",this.characterList="\u30AD\u30E3\u30E9\u30AF\u30BF\u30FC\u4E00\u89A7"}getSkillAbilityPage(){return this.homeUrl+this.skillAbilityPage}getSkillAbilitySsrList(){return this.homeUrl+this.editPage+this.skillAbilitySsrList}getSkillAbilitySrList(){return this.homeUrl+this.editPage+this.skillAbilitySrList}getWarGoddesList(){return this.homeUrl+this.characterList}};var o=document.getElementById("dropArea");if(!(o instanceof HTMLElement))throw new Error("Drop area with ID 'dropArea' not found.");var g=document.getElementById("inputField");if(!g)throw new Error("textarea with ID 'inputField' not found.");var l=document.getElementById("outputField");if(!l)throw new Error("textarea with ID 'outputField' not found.");var E=document.getElementById("iClearButton");if(!(E instanceof HTMLElement))throw new Error("Drop area with ID 'iClearButton' not found.");var y=document.getElementById("oClearButton");if(!(y instanceof HTMLElement))throw new Error("Drop area with ID 'oClearButton' not found.");o.addEventListener("dragover",t=>{t.preventDefault(),o.style.backgroundColor="#f0f0f0"});o.addEventListener("dragleave",()=>{o.style.backgroundColor=""});o.addEventListener("drop",t=>{if(t.preventDefault(),o.style.backgroundColor="",!(t instanceof DragEvent)||!t.dataTransfer)throw new Error("Unexpected event or missing dataTransfer");let e=t.dataTransfer.files;if(e.length>0&&e[0].type==="text/plain"){let r=new FileReader;r.onload=function(i){let n=i.target;if(!n)throw new Error("e.target\u304C\u306A\u3044\u3088");let a=n.result;if(typeof a!="string")throw new Error("\u8AAD\u307F\u8FBC\u3093\u3060\u7D50\u679C\u304C\u6587\u5B57\u5217\u3058\u3083\u306A\u3044\u3088");g.value=a;let s=l.value;l.value=p(g.value,s,new c,f)},r.readAsText(e[0],"UTF-8")}else alert("\u30D7\u30EC\u30FC\u30F3\u30C6\u30AD\u30B9\u30C8 (.txt) \u30D5\u30A1\u30A4\u30EB\u3092\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044\u3002")});var k=new u;document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("openPage1");t&&t.addEventListener("click",R)});function R(){window.open(k.getWarGoddesList(),"_blank")}var w;g.addEventListener("input",function(){clearTimeout(w),w=setTimeout(()=>{let t=l.value;l.value=p(this.value,t,new c,f)},200)});E.addEventListener("click",function(){g.value=""});y.addEventListener("click",function(){l.value=""});
//# sourceMappingURL=extractUnitDataTonofura.js.map