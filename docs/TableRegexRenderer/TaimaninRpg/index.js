"use strict";var d=class{constructor(){this.homeUrl="https://taimanin-rpg.wikiru.jp/?",this.editPage="cmd=edit&page=",this.skillAbilityPage="\u7DF4\u7FD2\u7528\u304A\u7802\u5834",this.skillAbilitySsrList="SandBox/\u30AD\u30E3\u30E9\u6027\u80FD\u30C6\u30FC\u30D6\u30EB",this.skillAbilitySrList="SandBox/\u30AD\u30E3\u30E9\u6027\u80FD\u30C6\u30FC\u30D6\u30EBSR\u914D\u5E03",this.characterList="\u30AD\u30E3\u30E9\u30AF\u30BF\u30FC\u4E00\u89A7"}getSkillAbilityPage(){return this.homeUrl+this.skillAbilityPage}getSkillAbilitySsrList(){return this.homeUrl+this.editPage+this.skillAbilitySsrList}getSkillAbilitySrList(){return this.homeUrl+this.editPage+this.skillAbilitySrList}getWarGoddesList(){return this.homeUrl+this.characterList}};function R(r){return new Promise((t,e)=>{let n=new FileReader;n.onload=()=>t(n.result),n.onerror=e,n.readAsText(r)})}function y(r,t){let e=r.split(/\r?\n/);for(let n=0;n<e.length;n++)for(let o of t)if(e[n].includes(o.keyword))return o.id;return null}function w(r,t){let e=document.getElementById(r);if(!(e instanceof HTMLElement))throw new Error(`Drop area with ID '${r}' not found.`);let n=["text/plain","text/csv"];e.addEventListener("dragover",o=>{o.preventDefault(),e.style.backgroundColor="#eee"}),e.addEventListener("dragleave",()=>{e.style.backgroundColor=""}),e.addEventListener("drop",async o=>{if(o.preventDefault(),e.style.backgroundColor="",!(o instanceof DragEvent)||!o.dataTransfer)throw new Error("Unexpected event or missing dataTransfer");let s=Array.from(o.dataTransfer.files).filter(l=>n.includes(l.type));for(let l of s){let i=await R(l),c=y(i,t);if(c){let a=document.getElementById(c);a&&(a.value=i)}}})}var h=class{constructor(t){this.articleLineNumber=t,this.filter=new RegExp(/(?!)/),this.except=new RegExp(/(?!)/)}setRegExp(t,e){t&&(this.filter=new RegExp(M(t)),console.log("PatternPair.filter:"+this.filter)),e!=""&&(this.except=new RegExp(e),console.log("PatternPair.except:"+this.except))}getFilter(){return this.filter}getExcept(){return this.except}hasFilter(){return!!this.filter}hasExcept(){return!!this.except}};function P(r){return r.replace(/#flex\(flex-start\)\{\{[\s\S]*?\}\}/g,"")}function K(r,t){return v(r,t,/filter=([^,]+)/)}function V(r,t){return v(r,t,/except=([^,]+)/)}function v(r,t,e){if(!r.includes(`#includex(${t}`))return"";let o=r.match(e),s=o?o[1]:"";return s&&(s=s.replace(/\.\{3\}/g,".{1}"),s=s.replace(/\]\{3\}/g,"]{1}")),console.log("extractRegex():"+e+" : "+s),s}function M(r){let t=r.replace("^#sort|\\|h$|\\|f$|\\|c$|","");return t=t.replace("^#sort|\\|h$|\\|f$|\\|c$|",""),t=t.replace("|^}}",""),console.log("removeSystemLineRegex:"+t),t}function A(r){if(r=="")return"";let t=new RegExp(/BGCOLOR\((#[0-9A-Za-z]+|[A-Za-z]+)\):/);if(r.match(t))return r;throw new Error(`BGCOLOR\u30BF\u30B0\u306E\u578B\u5F0F\u304C\u9593\u9055\u3063\u3066\u3044\u307E\u3059: ${r}`)}function N(r,t){let e=new Map;return r.forEach((n,o)=>{let s=K(n,t),l=V(n,t);(s||l)&&(e.has(o)||e.set(o,new h(o)),e.get(o).setRegExp(s,l))}),[...e.values()]}function S(r){let t=new RegExp("^#sort|\\|h$|\\|f$|\\|c$|^}}","m");return!r.match(t)}function O(r,t){return r.replace(/[0-9]+x[0-9]+/,t)}var x=class{constructor(t){let e=t.replace(/\[|\]/g,""),n=e.split(":"),o=n[1]?n[0]+":":"";this.bgcolorTag="",this.setBgcolorTag(o);let l=(n[1]?n[1]:e).split(">");if(this.refFunction=l[0].replace("attach",""),!this.refFunction)throw new Error("ref\u95A2\u6570\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F");if(this.pageName=l[1],!this.pageName)throw new Error("\u30DA\u30FC\u30B8\u540D\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F")}setBgcolorTag(t){this.bgcolorTag=A(t)}updateBgColorTag(t){this.bgcolorTag="BGCOLOR("+t.name+"):"}getPageName(){return this.pageName}getBgIconLink(){return this.bgcolorTag+"[["+this.refFunction+">"+this.pageName+"]]"}debugLog(){console.log("\u25BC WikiruIconLink"),console.log(`  Background Color Tag: ${this.bgcolorTag}`),console.log(`  Ref Function: ${this.refFunction}`),console.log(`  Page Name: ${this.pageName}`)}};var b=class{constructor(){this.unitNameColumnIndex=NaN}};var T=class extends b{constructor(){super(),this.unitNameColumnIndex=1}getStatusColumns(t){let e=t.split("|");return e.length>=9?"|"+e[1]+"|"+e[2]+"|"+e[3]+"|"+e[4]+"|"+e[5]+"|"+e[6]+"|"+e[7]+"|"+e[8]+"|"+e[9]+"|":""}getStatusHeader(t){return"|~\u753B\u50CF|~\u540D\u524D|~\u5C5E\u6027|~\u7279\u6027|~HP|~SP|~ATK|~DEF|~SPD|~\u30B3\u30E1\u30F3\u30C8|"}createIconTypeLink(t){let e=t.split("|");if(e.length<=this.unitNameColumnIndex)throw new Error("\u30E6\u30CB\u30C3\u30C8\u540D\u304C\u3042\u308B\u5217\u306E\u6307\u5B9A\u304C\u5217\u306E\u6570\u3092\u8D85\u3048\u3066\u3044\u307E\u3059");let n=e[this.unitNameColumnIndex],o=n.split(":");n=o[1]?o[1]:n,n=O(n,"80x80"),n=n.replaceAll("&br;","");let s=e[3];return s=s.split(":")[0],new x(s+":"+n)}};function g(r){let t=document.getElementById(r);if(!t)throw new Error(`element with ID '${r}' not found.`);return t}var m=class{constructor(){this.targets=new Map}get(t){return this.targets.get(t)}add(t,e){this.targets.set(t,e)}has(t){return this.targets.has(t)}values(){return Array.from(this.targets.values())}};var E=class{constructor(t,e,n){this.iconLink=t,this.comment=this.formatComment(e),this.statusColumns=n,this.debugLog()}formatComment(t){let e=t.replaceAll("&br;,","&br;");return e=e.replace(/,&br;$/,""),e=e.replaceAll(","," "),e}getIconInfo(){return this.iconLink.getBgIconLink()}getPageName(){return this.iconLink.getPageName()}getComment(){return this.comment}getStatusColumns(){return this.statusColumns}debugLog(){console.log("\u25BC FlexIconInfo"),console.log(`  Comment: ${this.comment}`),console.log(`  statusColumns: ${this.statusColumns}`),this.iconLink.debugLog()}};function F(r){let e=r.source.replace("^(?:[^|]*\\|){","");return e=e.replace(/^([0-9]+)/,""),e=e.replace("}[^|]*",""),e=e.replace("[^|]*(?=\\|)",""),console.log("removeSpecifyColumn:"+e),new RegExp(e,"g")}function $(r){let t=q(r.source);return console.log("columnIndex:"+t),t>0?t:NaN}function q(r){let e=r.replace("^(?:[^|]*\\|){","").replace(/^([0-9]+).*/,"$1");return parseInt(e)}function B(r,t){let e=[],n=r.match(t);console.log("matchedText[0]: "+(n?n[0]:""));let o=$(t),s=F(t),l=r.split("|"),i=null;return o?(i=l[o].match(s),console.log("line[columnIndex]:"+l[o]),console.log("match:"+i),i&&(console.log("match[0]:"+i[0]),e=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),e.length==0&&(e=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))):(i=l.map(c=>{let a=c.match(s);return a?a[0]:null}).filter(Boolean),console.log("match:"+i),i.length>0&&(console.log("match[0]:"+i[0]),e=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),e.length==0&&(e=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))),e.join()}function H(r,t){let e=[],n=$(t),o=F(t),s=r.split("|"),l=n?[s[n]]:[r];for(let i of l){let c=i.matchAll(o);for(let a of c){let u=Array.from(a).slice(1);u.length>0&&e.push(...u)}}return e=e.filter(i=>i!=null&&i!==""),e.join(",")}function W(r,t){return r instanceof RegExp?r.test(t):!1}var L=class{constructor(t){this.lineNumber=t,this.iconLimitExceeded=!1,this.customHeader="",this.iconInfos=[]}addIconInfo(t){this.iconInfos.push(t)}debugLog(){}outputFlexFunc(t){return D(this,t)}outputTable(){return j(this)}};function J(r,t,e,n){if(t.hasExcept()&&W(t.getExcept(),r)||t.hasFilter()&&!t.getFilter().test(r))return null;let o=e.createIconTypeLink(r);if(!o)return null;let s=n(r,t.getFilter());s=s.replaceAll("|","&br;");let l=e.getStatusColumns(r);return new E(o,s,l)}function G(r,t,e,n){let o=[...r],s=Array.from(t.targets.entries()).sort(([l],[i])=>l-i);for(let[l,i]of s){if(!i||i.iconInfos.length===0)continue;let c=`
`+(n===p.Flex?i.outputFlexFunc(e):i.outputTable()),a=-1;for(;l>0&&!o[l+a].includes("#region");)a--;o[l+a-1]+=c}return o}function D(r,t){let e=`#flex(flex-start){{
`;return r.iconInfos.forEach(n=>{e+=`#-
|${n.getIconInfo()}|
`,t&&n.getComment()&&(e+=`|${n.getComment()}|
`)}),r.iconLimitExceeded&&(e+=`#-
|etc|
`),e+="}}",e}function j(r){let t=r.customHeader+`h
`;return r.iconInfos.forEach(e=>{let n=e.getComment().replaceAll(" ","");t+=`${e.getStatusColumns()}${n}|
`}),r.iconLimitExceeded,t+=r.customHeader+"f",t}function U(r){let t=r.split(`
`),e=[],n=!1;for(let o of t){if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|h")){n=!0;continue}if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|f")){n=!1;continue}n||e.push(o)}return e.join(`
`)}function z(r,t,e,n,o){let s=new m;for(let l of t){if(!l.hasFilter())continue;let i=new L(l.articleLineNumber),c=0;for(let a of r){if(c>e){i.iconLimitExceeded=!0;break}if(a.endsWith("|h")){i.customHeader=n.getStatusHeader(a);continue}if(!S(a))continue;let u=J(a,l,n,o);u&&(i.addIconInfo(u),c++)}i.debugLog(),s.add(l.articleLineNumber,i)}return s}var p={Flex:"flex",Table:"table"},f={NumbersText:"NumbersText",CapturingGroups:"CapturingGroups"},C=class{constructor(t,e,n,o,s,l,i,c){this.profile=t,this.article=e.split(`
`),this.table=n.split(`
`),this.tableName=o,this.maxOutput=s,this.isOutputComment=l,this.commentExtractMethod=i||f.NumbersText,this.outputMethod=c||p.Flex}getCommentExtractor(){switch(this.commentExtractMethod){case f.NumbersText:return B;case f.CapturingGroups:return H;default:throw new Error(`Unknown commentExtractMethod: ${this.commentExtractMethod}`)}}},I=class{constructor(t){this.profile=t.profile,this.article=t.article,this.table=t.table,this.pageName=t.tableName,this.maxOutput=t.maxOutput,this.isOutputComment=t.isOutputComment,this.commentExtractor=t.getCommentExtractor(),this.outputMethod=t.outputMethod,this.insertTargetManager=new m,this.patternPairs=[],this.outputLines=[]}insertMatchedObjectsToArticle(){return this.patternPairs=N(this.article,this.pageName),this.insertTargetManager=z(this.table,this.patternPairs,this.maxOutput,this.profile,this.commentExtractor.bind(this)),this.outputLines=G(this.article,this.insertTargetManager,this.isOutputComment,this.outputMethod),this.outputLines.map(t=>t.trim()).join(`
`)}};function _(r){let{profile:t,article:e,tables:n,tableNames:o,maxOutput:s,isOutputComment:l,captureMode:i=f.CapturingGroups,outputMethod:c=p.Flex}=r,a=P(e);a=U(a);for(let u=0;u<n.length;u++){if(!n[u])continue;let Z=new C(t,a,n[u],o[u],s,l,i,c);a=new I(Z).insertMatchedObjectsToArticle()}return a}var k=new d,Q=g("article"),X=g("output"),Y=g("table1"),tt=g("table2"),et=g("inputNumber1"),rt=g("tableName1"),nt=g("tableName2"),ot=g("checkBox1"),it=g("checkBox2"),st=g("outPutSelect"),lt=[{keyword:"SR/\u79CB\u5C71\u51DC\u5B50",id:"table1"},{keyword:"SR/\u3010\u6700\u5F37\u306E\u5BFE\u9B54\u5FCD\u3011\u4E95\u6CB3\u30A2\u30B5\u30AE",id:"table2"}];w("dropArea",lt);document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage1");r&&r.addEventListener("click",ct)});function ct(){window.open(k.getSkillAbilityPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage2");r&&r.addEventListener("click",at)});function at(){window.open(k.getSkillAbilitySsrList(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage3");r&&r.addEventListener("click",ut)});function ut(){window.open(k.getSkillAbilitySrList(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("execute");r&&r.addEventListener("click",gt)});function gt(){let r=it.checked?"CapturingGroups":"NumbersText",t=parseInt(et.value,10),e=_({profile:new T,article:Q.value,tables:[Y.value,tt.value],tableNames:[rt.value,nt.value],maxOutput:t,isOutputComment:ot.checked,captureMode:r,outputMethod:st.value});X.value=e}
//# sourceMappingURL=index.js.map