"use strict";var x=class{constructor(){this.homeUrl="https://tonofura.wikiru.jp/?",this.editPage="cmd=edit&page=",this.skillAbilityPage="\u30B9\u30AD\u30EB\u52B9\u679C\u5225\u4E00\u89A7",this.skillAbilitySsrList="\u30C6\u30FC\u30D6\u30EB/\u30B9\u30AD\u30EB\u30FB\u30A2\u30D3\u30EA\u30C6\u30A3/SSR",this.skillAbilitySrList="\u30C6\u30FC\u30D6\u30EB/\u30B9\u30AD\u30EB\u30FB\u30A2\u30D3\u30EA\u30C6\u30A3/SR",this.characterList="\u30AD\u30E3\u30E9\u30AF\u30BF\u30FC\u4E00\u89A7"}getSkillAbilityPage(){return this.homeUrl+this.skillAbilityPage}getSkillAbilitySsrList(){return this.homeUrl+this.editPage+this.skillAbilitySsrList}getSkillAbilitySrList(){return this.homeUrl+this.editPage+this.skillAbilitySrList}getWarGoddesList(){return this.homeUrl+this.characterList}};function R(r){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsText(r)})}function v(r,e){let t=r.split(/\r?\n/);for(let n=0;n<t.length;n++)for(let o of e)if(t[n].includes(o.keyword))return o.id;return null}function M(r,e){let t=document.getElementById(r);if(!(t instanceof HTMLElement))throw new Error(`Drop area with ID '${r}' not found.`);let n=["text/plain","text/csv"];t.addEventListener("dragover",o=>{o.preventDefault(),t.style.backgroundColor="#eee"}),t.addEventListener("dragleave",()=>{t.style.backgroundColor=""}),t.addEventListener("drop",async o=>{if(o.preventDefault(),t.style.backgroundColor="",!(o instanceof DragEvent)||!o.dataTransfer)throw new Error("Unexpected event or missing dataTransfer");let s=Array.from(o.dataTransfer.files).filter(a=>n.includes(a.type));for(let a of s){let i=await R(a),c=v(i,e);if(c){let l=document.getElementById(c);l&&(l.value=i)}}})}var b=class{constructor(e){this.articleLineNumber=e,this.filter=new RegExp(/(?!)/),this.except=new RegExp(/(?!)/)}setRegExp(e,t){e&&(this.filter=new RegExp(P(e)),console.log("PatternPair.filter:"+this.filter)),t!=""&&(this.except=new RegExp(t),console.log("PatternPair.except:"+this.except))}getFilter(){return this.filter}getExcept(){return this.except}hasFilter(){return!!this.filter}hasExcept(){return!!this.except}};function N(r){return r.replace(/#flex\(flex-start\)\{\{[\s\S]*?\}\}/g,"")}function Z(r,e){return A(r,e,/filter=([^,]+)/)}function K(r,e){return A(r,e,/except=([^,]+)/)}function A(r,e,t){if(!r.includes(`#includex(${e}`))return"";let o=r.match(t),s=o?o[1]:"";return s&&(s=s.replace(/\.\{3\}/g,".{1}"),s=s.replace(/\]\{3\}/g,"]{1}")),console.log("extractRegex():"+t+" : "+s),s}function P(r){let e=r.replace("^#sort|\\|h$|\\|f$|\\|c$|","");return e=e.replace("^#sort|\\|h$|\\|f$|\\|c$|",""),e=e.replace("|^}}",""),console.log("removeSystemLineRegex:"+e),e}function F(r){if(r=="")return"";let e=new RegExp(/BGCOLOR\((#[0-9A-Za-z]+|[A-Za-z]+)\):/);if(r.match(e))return r;throw new Error(`BGCOLOR\u30BF\u30B0\u306E\u578B\u5F0F\u304C\u9593\u9055\u3063\u3066\u3044\u307E\u3059: ${r}`)}function S(r,e){let t=new Map;return r.forEach((n,o)=>{let s=Z(n,e),a=K(n,e);(s||a)&&(t.has(o)||t.set(o,new b(o)),t.get(o).setRegExp(s,a))}),[...t.values()]}function O(r){let e=new RegExp("^#sort|\\|h$|\\|f$|\\|c$|^}}","m");return!r.match(e)}var h=class{constructor(e){let t=e.replace(/\[|\]/g,""),n=t.split(":"),o=n[1]?n[0]+":":"";this.bgcolorTag="",this.setBgcolorTag(o);let a=(n[1]?n[1]:t).split(">");if(this.refFunction=a[0].replace("attach",""),!this.refFunction)throw new Error("ref\u95A2\u6570\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F");if(this.pageName=a[1],!this.pageName)throw new Error("\u30DA\u30FC\u30B8\u540D\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F")}setBgcolorTag(e){this.bgcolorTag=F(e)}updateBgColorTag(e){this.bgcolorTag="BGCOLOR("+e.name+"):"}getPageName(){return this.pageName}getBgIconLink(){return this.bgcolorTag+"[["+this.refFunction+">"+this.pageName+"]]"}debugLog(){console.log("\u25BC WikiruIconLink"),console.log(`  Background Color Tag: ${this.bgcolorTag}`),console.log(`  Ref Function: ${this.refFunction}`),console.log(`  Page Name: ${this.pageName}`)}};var T=class{constructor(e){if(!this.validateColor(e))throw new Error("wiki\u3067\u6709\u52B9\u306A\u8272\u3067\u306F\u3042\u308A\u307E\u305B\u3093");this.name=e}validateColor(e){let t=new RegExp(/#[a-fA-F0-9]{6}/);if(e.match(t))return!0;let n=new RegExp(/#[a-fA-F0-9]{3}/);return!!(e.match(n)||Q(e))}},J=new Set(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]);function Q(r){return J.has(r.toLowerCase())}var k=class{constructor(){this.unitNameColumnIndex=NaN}};var E=class extends k{constructor(){super(),this.unitNameColumnIndex=2}getStatusColumns(e){let t=e.split("|");return t.length>=6?"|"+t[1]+"|"+t[2]+"|"+t[3]+"|"+t[5]+"|":""}getStatusHeader(e){return"|~\u753B\u50CF|~\u540D\u524D|~\u5C5E\u6027|~ATK|~\u30B3\u30E1\u30F3\u30C8|"}createIconTypeLink(e){let t=e.split("|"),n=t[1].replace(/^\[\[|\]\]$/g,"");n=n.split(">")[0];let o=t[2].replace(/^\[\[|\]\]$/g,"");console.log("createIconTypeLink:"+o);let s=this.getUnitColor(o);return s?new h("BGCOLOR("+s.name+"):"+n+">"+o):new h(n+">"+o)}getUnitColor(e){let t=/(.*?)［(.*?)］/,n=e.match(t),o="";if(n){let s=n[1],a=n[2];switch(s){case"\u30C6\u30EB\u30C6\u30A3\u30A2":switch(a){case"\u7406\u89E3\u6C42\u3080\u5922":o=m.Fire;break;case"\u53E1\u7406\u6B32\u3059\u610F\u8C61":o=m.Thunder;break;case"\u611B\u306B\u63FA\u308C\u308B\u60F3\u7247":o=m.Wind;break}break;case"\u4E9C\u7D17\u82B1":case"\u30A2\u30B5\u30AB":case"\u65FA\u83EF":case"\u30F4\u30A3\u30FC":case"\u7A7A\u72D0":case"\u30ED\u30BC\u30C3\u30C8":case"\u8389\u702C":case"\u30AD\u30EA\u30A8":case"\u30DE\u30EA\u30CA":case"\u30A4\u30EA\u30A2":case"\u30A2\u30FC\u30C7\u30EB":case"\u5B6B\u6A29":case"\u30AB\u30B9\u30DF":case"\u693F":case"\u30EA\u30FC\u30BC\u30ED\u30C3\u30C6":o=m.Fire;break;case"\u30D6\u30EA\u30B8\u30C3\u30C8":case"\u30A4\u30EA\u30FC\u30CA":case"\u30EA\u30C7\u30A3\u30A2":case"\u30B7\u30EB\u30F4\u30A3":case"\u30A8\u30FC\u30EA\u30AB":case"\u30BD\u30FC\u30AB":case"\u30E6\u30A4":case"\u7D2B\u967D\u82B1":case"\u30E1\u30C1\u30EB":case"\u8A69\u4E43":case"\u7D05\u8449":case"\u30B8\u30E3\u30F3\u30CC":o=m.Water;break;case"\u30C0\u30CA":case"\u30DB\u30EA\u30A3":case"\u30DF\u30EB\u30F4\u30A1":case"\u30D9\u30A2\u30C8\u30EA\u30FC\u30B5":case"\u30AF\u30A3\u30F3\u30B7\u30FC":case"\u30A2\u30EB\u30DE":case"\u30E9\u30BA\u30EB\u30FC\u30AB":case"\u3056\u304F\u308D":case"\u30BC\u30ED":case"\u30AE\u30F3\u30D0\u30CD":case"\u30B5\u30AF\u30E9":case"\u30E6\u30A8":case"\u96DB":case"\u6C99\u8036":o=m.Wind;break;case"\u30A8\u30C7\u30EB\u30AC\u30EB\u30C9":case"\u30EA\u30F3":case"\u30BC\u30CE":case"\u30DF\u30EA\u30A2\u30E0":case"\u30D1\u30C8\u30EA\u30B7\u30A2":case"\u30EB\u30A4\u30FC\u30BA":case"\u30B5\u30FC\u30B7\u30E3":case"\u8309\u8389":case"\u30BD\u30D5\u30A1\u30B9":case"\u9805\u7FBD":case"\u4E45\u9060":case"\u30A2\u30EA\u30B9":o=m.Thunder;break;case"\u30AB\u30C6\u30A3\u30A2":case"\u30B8\u30BC\u30EB":case"\u82B3\u4E43":case"\u30DE\u30EB\u30BF":case"\u30A2\u30F3\u30CA":case"\u30D5\u30E9\u30A6":case"\u30EA\u30A3\u30F3":case"\u30AF\u30E9\u30A6\u30BD\u30E9\u30B9":case"\u30A2\u30A4\u30AB":case"\u611B\u82B1":case"\u30E6\u30EA\u30A2\u30CA":case"\u30E9\u30D5\u30A3\u30F3":case"\u30E6\u30FC\u30D5\u30A1":case"\u5289\u5099":case"\u4E5D\u82B1":case"\u30EA\u30BC\u30C3\u30C8":o=m.Light;break;case"\u30B8\u30E3\u30DF\u30E9":case"\u30BF\u30D0\u30B5":case"\u30A6\u30EB\u30B9\u30E9":case"\u821E\u591C":case"\u30CE\u30EB\u30F3":case"\u4E03\u7FBD":case"\u5929\u9B54":case"\u30DE\u30EA\u30A2":case"\u30B8\u30E5\u30EA\u30A2":case"\u30DA\u30EB\u30D5\u30A7":case"\u30B8\u30EB\u30F4\u30A1\u30E9":case"\u30E6\u30FC":case"\u66F9\u64CD":case"\u90FD\u5B50":case"\u30AB\u30B0\u30E4":case"\u30DF\u30C3\u30C9\u30A6\u30A7\u30FC":o=m.Dark;break;default:}}return o!=""?new T(o):null}},m={Fire:"#F8C7C7",Water:"#BFD6F6",Wind:"#CDEFC0",Thunder:"#FEE3C1",Light:"#FBFAE7",Dark:"#E5C0F4"};function g(r){let e=document.getElementById(r);if(!e)throw new Error(`element with ID '${r}' not found.`);return e}var d=class{constructor(){this.targets=new Map}get(e){return this.targets.get(e)}add(e,t){this.targets.set(e,t)}has(e){return this.targets.has(e)}values(){return Array.from(this.targets.values())}};var y=class{constructor(e,t,n){this.iconLink=e,this.comment=this.formatComment(t),this.statusColumns=n,this.debugLog()}formatComment(e){let t=e.replaceAll("&br;,","&br;");return t=t.replace(/,&br;$/,""),t=t.replaceAll(","," "),t}getIconInfo(){return this.iconLink.getBgIconLink()}getPageName(){return this.iconLink.getPageName()}getComment(){return this.comment}getStatusColumns(){return this.statusColumns}debugLog(){console.log("\u25BC FlexIconInfo"),console.log(`  Comment: ${this.comment}`),console.log(`  statusColumns: ${this.statusColumns}`),this.iconLink.debugLog()}};function B(r){let t=r.source.replace("^(?:[^|]*\\|){","");return t=t.replace(/^([0-9]+)/,""),t=t.replace("}[^|]*",""),t=t.replace("[^|]*(?=\\|)",""),console.log("removeSpecifyColumn:"+t),new RegExp(t,"g")}function $(r){let e=X(r.source);return console.log("columnIndex:"+e),e>0?e:NaN}function X(r){let t=r.replace("^(?:[^|]*\\|){","").replace(/^([0-9]+).*/,"$1");return parseInt(t)}function W(r,e){let t=[],n=r.match(e);console.log("matchedText[0]: "+(n?n[0]:""));let o=$(e),s=B(e),a=r.split("|"),i=null;return o?(i=a[o].match(s),console.log("line[columnIndex]:"+a[o]),console.log("match:"+i),i&&(console.log("match[0]:"+i[0]),t=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),t.length==0&&(t=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))):(i=a.map(c=>{let l=c.match(s);return l?l[0]:null}).filter(Boolean),console.log("match:"+i),i.length>0&&(console.log("match[0]:"+i[0]),t=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),t.length==0&&(t=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))),t.join()}function D(r,e){let t=[],n=$(e),o=B(e),s=r.split("|"),a=n?[s[n]]:[r];for(let i of a){let c=i.matchAll(o);for(let l of c){let u=Array.from(l).slice(1);u.length>0&&t.push(...u)}}return t=t.filter(i=>i!=null&&i!==""),t.join(",")}function H(r,e){return r instanceof RegExp?r.test(e):!1}var C=class{constructor(e){this.lineNumber=e,this.iconLimitExceeded=!1,this.customHeader="",this.iconInfos=[]}addIconInfo(e){this.iconInfos.push(e)}debugLog(){}outputFlexFunc(e){return j(this,e)}outputTable(){return G(this)}};function Y(r,e,t,n){if(e.hasExcept()&&H(e.getExcept(),r)||e.hasFilter()&&!e.getFilter().test(r))return null;let o=t.createIconTypeLink(r);if(!o)return null;let s=n(r,e.getFilter());s=s.replaceAll("|","&br;");let a=t.getStatusColumns(r);return new y(o,s,a)}function U(r,e,t,n){let o=[...r],s=Array.from(e.targets.entries()).sort(([a],[i])=>a-i);for(let[a,i]of s){if(!i||i.iconInfos.length===0)continue;let c=`
`+(n===f.Flex?i.outputFlexFunc(t):i.outputTable()),l=-1;for(;a>0&&!o[a+l].includes("#region");)l--;o[a+l-1]+=c}return o}function j(r,e){let t=`#flex(flex-start){{
`;return r.iconInfos.forEach(n=>{t+=`#-
|${n.getIconInfo()}|
`,e&&n.getComment()&&(t+=`|${n.getComment()}|
`)}),r.iconLimitExceeded&&(t+=`#-
|etc|
`),t+="}}",t}function G(r){let e=r.customHeader+`h
`;return r.iconInfos.forEach(t=>{let n=t.getComment().replaceAll(" ","");e+=`${t.getStatusColumns()}${n}|
`}),r.iconLimitExceeded,e+=r.customHeader+"f",e}function q(r){let e=r.split(`
`),t=[],n=!1;for(let o of e){if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|h")){n=!0;continue}if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|f")){n=!1;continue}n||t.push(o)}return t.join(`
`)}function z(r,e,t,n,o){let s=new d;for(let a of e){if(!a.hasFilter())continue;let i=new C(a.articleLineNumber),c=0;for(let l of r){if(c>t){i.iconLimitExceeded=!0;break}if(l.endsWith("|h")){i.customHeader=n.getStatusHeader(l);continue}if(!O(l))continue;let u=Y(l,a,n,o);u&&(i.addIconInfo(u),c++)}i.debugLog(),s.add(a.articleLineNumber,i)}return s}var f={Flex:"flex",Table:"table"},p={NumbersText:"NumbersText",CapturingGroups:"CapturingGroups"},L=class{constructor(e,t,n,o,s,a,i,c){this.profile=e,this.article=t.split(`
`),this.table=n.split(`
`),this.tableName=o,this.maxOutput=s,this.isOutputComment=a,this.commentExtractMethod=i||p.NumbersText,this.outputMethod=c||f.Flex}getCommentExtractor(){switch(this.commentExtractMethod){case p.NumbersText:return W;case p.CapturingGroups:return D;default:throw new Error(`Unknown commentExtractMethod: ${this.commentExtractMethod}`)}}},w=class{constructor(e){this.profile=e.profile,this.article=e.article,this.table=e.table,this.pageName=e.tableName,this.maxOutput=e.maxOutput,this.isOutputComment=e.isOutputComment,this.commentExtractor=e.getCommentExtractor(),this.outputMethod=e.outputMethod,this.insertTargetManager=new d,this.patternPairs=[],this.outputLines=[]}insertMatchedObjectsToArticle(){return this.patternPairs=S(this.article,this.pageName),this.insertTargetManager=z(this.table,this.patternPairs,this.maxOutput,this.profile,this.commentExtractor.bind(this)),this.outputLines=U(this.article,this.insertTargetManager,this.isOutputComment,this.outputMethod),this.outputLines.map(e=>e.trim()).join(`
`)}};function _(r){let{profile:e,article:t,tables:n,tableNames:o,maxOutput:s,isOutputComment:a,captureMode:i=p.CapturingGroups,outputMethod:c=f.Flex}=r,l=N(t);l=q(l);for(let u=0;u<n.length;u++){if(!n[u])continue;let V=new L(e,l,n[u],o[u],s,a,i,c);l=new w(V).insertMatchedObjectsToArticle()}return l}var I=new x,ee=g("article"),te=g("output"),re=g("table1"),ne=g("table2"),oe=g("inputNumber1"),ie=g("tableName1"),se=g("tableName2"),ae=g("checkBox1"),ce=g("checkBox2"),le=g("outPutSelect"),ue=[{keyword:"\u30C8\u30E9\u30B9\u30C8\u30A2\u30D3",id:"table1"},{keyword:"\u30B5\u30DD\u30A2\u30D3|h",id:"table2"}];M("dropArea",ue);document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage1");r&&r.addEventListener("click",ge)});function ge(){window.open(I.getSkillAbilityPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage2");r&&r.addEventListener("click",me)});function me(){window.open(I.getSkillAbilitySsrList(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("openPage3");r&&r.addEventListener("click",pe)});function pe(){window.open(I.getSkillAbilitySrList(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let r=document.getElementById("execute");r&&r.addEventListener("click",de)});function de(){let r=ce.checked?p.CapturingGroups:p.NumbersText,e=_({profile:new E,article:ee.value,tables:[re.value,ne.value],tableNames:[ie.value,se.value],maxOutput:parseInt(oe.value,10),isOutputComment:ae.checked,captureMode:r,outputMethod:le.value});te.value=e}
//# sourceMappingURL=index.js.map