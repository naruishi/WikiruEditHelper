"use strict";var f=class{constructor(){this.homeUrl="https://minashigo.wikiru.jp/?",this.editPage="cmd=edit&page=",this.page1="\u7DF4\u7FD2\u7528\u304A\u7802\u5834",this.page2="\u30C6\u30FC\u30D6\u30EB/\u30AD\u30E3\u30E9\u6027\u80FD\u6BD4\u8F03",this.page3="\u30C6\u30FC\u30D6\u30EB/\u6B66\u5668\u65E9\u898B\u8868",this.page4="\u30C6\u30FC\u30D6\u30EB/\u6226\u795E\u6027\u80FD\u6BD4\u8F03"}getTrainingPage(){return this.homeUrl+this.page1}getMinashigoSsrListPage(){return this.homeUrl+this.editPage+this.page2}getWeaponListPage(){return this.homeUrl+this.editPage+this.page3}getWarGoddessListPage(){return this.homeUrl+this.editPage+this.page4}};function w(n){return new Promise((t,e)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e,r.readAsText(n)})}function P(n,t){let e=n.split(/\r?\n/);for(let r=0;r<e.length;r++)for(let o of t)if(e[r].includes(o.keyword))return o.id;return null}function M(n,t){let e=document.getElementById(n);if(!(e instanceof HTMLElement))throw new Error(`Drop area with ID '${n}' not found.`);let r=["text/plain","text/csv"];e.addEventListener("dragover",o=>{o.preventDefault(),e.style.backgroundColor="#eee"}),e.addEventListener("dragleave",()=>{e.style.backgroundColor=""}),e.addEventListener("drop",async o=>{if(o.preventDefault(),e.style.backgroundColor="",!(o instanceof DragEvent)||!o.dataTransfer)throw new Error("Unexpected event or missing dataTransfer");let a=Array.from(o.dataTransfer.files).filter(s=>r.includes(s.type));for(let s of a){let i=await w(s),c=P(i,t);if(c){let l=document.getElementById(c);l&&(l.value=i)}}})}var h=class{constructor(t){this.articleLineNumber=t,this.filter=new RegExp(/(?!)/),this.except=new RegExp(/(?!)/)}setRegExp(t,e){t&&(this.filter=new RegExp(k(t)),console.log("PatternPair.filter:"+this.filter)),e!=""&&(this.except=new RegExp(e),console.log("PatternPair.except:"+this.except))}getFilter(){return this.filter}getExcept(){return this.except}hasFilter(){return!!this.filter}hasExcept(){return!!this.except}};function y(n){return n.replace(/#flex\(flex-start\)\{\{[\s\S]*?\}\}/g,"")}function V(n,t){return v(n,t,/filter=([^,]+)/)}function q(n,t){return v(n,t,/except=([^,]+)/)}function v(n,t,e){if(!n.includes(`#includex(${t}`))return"";let o=n.match(e),a=o?o[1]:"";return a&&(a=a.replace(/\.\{3\}/g,".{1}"),a=a.replace(/\]\{3\}/g,"]{1}")),console.log("extractRegex():"+e+" : "+a),a}function k(n){let t=n.replace("^#sort|\\|h$|\\|f$|\\|c$|","");return t=t.replace("^#sort|\\|h$|\\|f$|\\|c$|",""),t=t.replace("|^}}",""),console.log("removeSystemLineRegex:"+t),t}function N(n){if(n=="")return"";let t=new RegExp(/BGCOLOR\((#[0-9A-Za-z]+|[A-Za-z]+)\):/);if(n.match(t))return n;throw new Error(`BGCOLOR\u30BF\u30B0\u306E\u578B\u5F0F\u304C\u9593\u9055\u3063\u3066\u3044\u307E\u3059: ${n}`)}function O(n,t){let e=new Map;return n.forEach((r,o)=>{let a=V(r,t),s=q(r,t);(a||s)&&(e.has(o)||e.set(o,new h(o)),e.get(o).setRegExp(a,s))}),[...e.values()]}function A(n){let t=new RegExp("^#sort|\\|h$|\\|f$|\\|c$|^}}","m");return!n.match(t)}function F(n,t){return n.replace(/[0-9]+x[0-9]+/,t)}var x=class{constructor(t){let e=t.replace(/\[|\]/g,""),r=e.split(":"),o=r[1]?r[0]+":":"";this.bgcolorTag="",this.setBgcolorTag(o);let s=(r[1]?r[1]:e).split(">");if(this.refFunction=s[0].replace("attach",""),!this.refFunction)throw new Error("ref\u95A2\u6570\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F");if(this.pageName=s[1],!this.pageName)throw new Error("\u30DA\u30FC\u30B8\u540D\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F")}setBgcolorTag(t){this.bgcolorTag=N(t)}updateBgColorTag(t){this.bgcolorTag="BGCOLOR("+t.name+"):"}getPageName(){return this.pageName}getBgIconLink(){return this.bgcolorTag+"[["+this.refFunction+">"+this.pageName+"]]"}debugLog(){console.log("\u25BC WikiruIconLink"),console.log(`  Background Color Tag: ${this.bgcolorTag}`),console.log(`  Ref Function: ${this.refFunction}`),console.log(`  Page Name: ${this.pageName}`)}};var b=class{constructor(){this.unitNameColumnIndex=NaN}};var T=class extends b{constructor(){super(),this.unitNameColumnIndex=1}getStatusColumns(t){let e=t.split("|");return t.includes("\u3010BS\u3011")?"|"+e[1]+"|"+e[2]+"|"+e[3]+"|"+e[4]+"|":"|"+e[1]+"|"+e[2]+"|"+e[3]+"|"}getStatusHeader(t){return t.includes("\u6226\u795E\u30B9\u30AD\u30EB")?"|~\u540D\u524D|~\u6B66\u5668|~\u7269\u9B54|~\u30B3\u30E1\u30F3\u30C8|":t.includes("\u6B66\u5668\u540D")?"|~\u540D\u524D|~\u6B66\u5668|~\u7A2E|~\u30B3\u30E1\u30F3\u30C8|":"|~\u540D\u524D|~\u6B66\u5668|~\u6B66\u5668|~\u7269\u9B54|~\u30B3\u30E1\u30F3\u30C8|"}createIconTypeLink(t){let e=t.replace(/^\[\[|\]\]$/g,"").split("|"),r=e[this.unitNameColumnIndex];if(e.length<=this.unitNameColumnIndex)throw new Error("\u30E6\u30CB\u30C3\u30C8\u540D\u304C\u3042\u308B\u5217\u306E\u6307\u5B9A\u304C\u5217\u306E\u6570\u3092\u8D85\u3048\u3066\u3044\u307E\u3059");let o=r.split(":"),a;o[1]?(r=o[1],a=o[0]+":"):(r=r,a="");let s=r.match(/(&ref.*?\);)/),i=s?F(s[1],"80x80"):"";s=r.match(/>(.*?)\]/);let c=s?s[1]:"";return new x(a+i+">"+c)}};function g(n){let t=document.getElementById(n);if(!t)throw new Error(`element with ID '${n}' not found.`);return t}var m=class{constructor(){this.targets=new Map}get(t){return this.targets.get(t)}add(t,e){this.targets.set(t,e)}has(t){return this.targets.has(t)}values(){return Array.from(this.targets.values())}};var E=class{constructor(t,e,r){this.iconLink=t,this.comment=this.formatComment(e),this.statusColumns=r,this.debugLog()}formatComment(t){let e=t.replaceAll("&br;,","&br;");return e=e.replace(/,&br;$/,""),e=e.replaceAll(","," "),e}getIconInfo(){return this.iconLink.getBgIconLink()}getPageName(){return this.iconLink.getPageName()}getComment(){return this.comment}getStatusColumns(){return this.statusColumns}debugLog(){console.log("\u25BC FlexIconInfo"),console.log(`  Comment: ${this.comment}`),console.log(`  statusColumns: ${this.statusColumns}`),this.iconLink.debugLog()}};function $(n){let e=n.source.replace("^(?:[^|]*\\|){","");return e=e.replace(/^([0-9]+)/,""),e=e.replace("}[^|]*",""),e=e.replace("[^|]*(?=\\|)",""),console.log("removeSpecifyColumn:"+e),new RegExp(e,"g")}function B(n){let t=J(n.source);return console.log("columnIndex:"+t),t>0?t:NaN}function J(n){let e=n.replace("^(?:[^|]*\\|){","").replace(/^([0-9]+).*/,"$1");return parseInt(e)}function W(n,t){let e=[],r=n.match(t);console.log("matchedText[0]: "+(r?r[0]:""));let o=B(t),a=$(t),s=n.split("|"),i=null;return o?(i=s[o].match(a),console.log("line[columnIndex]:"+s[o]),console.log("match:"+i),i&&(console.log("match[0]:"+i[0]),e=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),e.length==0&&(e=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))):(i=s.map(c=>{let l=c.match(a);return l?l[0]:null}).filter(Boolean),console.log("match:"+i),i.length>0&&(console.log("match[0]:"+i[0]),e=Array.from(i[0].matchAll(/([0-9]+)?(〜|～)?[0-9]+%|[0-9]+/g),c=>c[0]),e.length==0&&(e=Array.from(i[0].matchAll(/[0-9]+/g),c=>c[0])))),e.join()}function S(n,t){let e=[],r=B(t),o=$(t),a=n.split("|"),s=r?[a[r]]:[n];for(let i of s){let c=i.matchAll(o);for(let l of c){let u=Array.from(l).slice(1);u.length>0&&e.push(...u)}}return e=e.filter(i=>i!=null&&i!==""),e.join(",")}function H(n,t){return n instanceof RegExp?n.test(t):!1}var L=class{constructor(t){this.lineNumber=t,this.iconLimitExceeded=!1,this.customHeader="",this.iconInfos=[]}addIconInfo(t){this.iconInfos.push(t)}debugLog(){}outputFlexFunc(t){return D(this,t)}outputTable(){return j(this)}};function K(n,t,e,r){if(t.hasExcept()&&H(t.getExcept(),n)||t.hasFilter()&&!t.getFilter().test(n))return null;let o=e.createIconTypeLink(n);if(!o)return null;let a=r(n,t.getFilter());a=a.replaceAll("|","&br;");let s=e.getStatusColumns(n);return new E(o,a,s)}function G(n,t,e,r){let o=[...n],a=Array.from(t.targets.entries()).sort(([s],[i])=>s-i);for(let[s,i]of a){if(!i||i.iconInfos.length===0)continue;let c=`
`+(r===p.Flex?i.outputFlexFunc(e):i.outputTable()),l=-1;for(;s>0&&!o[s+l].includes("#region");)l--;o[s+l-1]+=c}return o}function D(n,t){let e=`#flex(flex-start){{
`;return n.iconInfos.forEach(r=>{e+=`#-
|${r.getIconInfo()}|
`,t&&r.getComment()&&(e+=`|${r.getComment()}|
`)}),n.iconLimitExceeded&&(e+=`#-
|etc|
`),e+="}}",e}function j(n){let t=n.customHeader+`h
`;return n.iconInfos.forEach(e=>{let r=e.getComment().replaceAll(" ","");t+=`${e.getStatusColumns()}${r}|
`}),n.iconLimitExceeded,t+=n.customHeader+"f",t}function U(n){let t=n.split(`
`),e=[],r=!1;for(let o of t){if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|h")){r=!0;continue}if(o.endsWith("|~\u30B3\u30E1\u30F3\u30C8|f")){r=!1;continue}r||e.push(o)}return e.join(`
`)}function z(n,t,e,r,o){let a=new m;for(let s of t){if(!s.hasFilter())continue;let i=new L(s.articleLineNumber),c=0;for(let l of n){if(c>e){i.iconLimitExceeded=!0;break}if(l.endsWith("|h")){i.customHeader=r.getStatusHeader(l);continue}if(!A(l))continue;let u=K(l,s,r,o);u&&(i.addIconInfo(u),c++)}i.debugLog(),a.add(s.articleLineNumber,i)}return a}var p={Flex:"flex",Table:"table"},d={NumbersText:"NumbersText",CapturingGroups:"CapturingGroups"},C=class{constructor(t,e,r,o,a,s,i,c){this.profile=t,this.article=e.split(`
`),this.table=r.split(`
`),this.tableName=o,this.maxOutput=a,this.isOutputComment=s,this.commentExtractMethod=i||d.NumbersText,this.outputMethod=c||p.Flex}getCommentExtractor(){switch(this.commentExtractMethod){case d.NumbersText:return W;case d.CapturingGroups:return S;default:throw new Error(`Unknown commentExtractMethod: ${this.commentExtractMethod}`)}}},I=class{constructor(t){this.profile=t.profile,this.article=t.article,this.table=t.table,this.pageName=t.tableName,this.maxOutput=t.maxOutput,this.isOutputComment=t.isOutputComment,this.commentExtractor=t.getCommentExtractor(),this.outputMethod=t.outputMethod,this.insertTargetManager=new m,this.patternPairs=[],this.outputLines=[]}insertMatchedObjectsToArticle(){return this.patternPairs=O(this.article,this.pageName),this.insertTargetManager=z(this.table,this.patternPairs,this.maxOutput,this.profile,this.commentExtractor.bind(this)),this.outputLines=G(this.article,this.insertTargetManager,this.isOutputComment,this.outputMethod),this.outputLines.map(t=>t.trim()).join(`
`)}};function _(n){let{profile:t,article:e,tables:r,tableNames:o,maxOutput:a,isOutputComment:s,captureMode:i=d.CapturingGroups,outputMethod:c=p.Flex}=n,l=y(e);l=U(l);for(let u=0;u<r.length;u++){if(!r[u])continue;let Z=new C(t,l,r[u],o[u],a,s,i,c);l=new I(Z).insertMatchedObjectsToArticle()}return l}var R=new f,Q=g("article"),X=g("output"),Y=g("table1"),tt=g("table2"),et=g("table3"),nt=g("inputNumber1"),rt=g("tableName1"),ot=g("tableName2"),it=g("tableName3"),st=g("checkBox1"),at=[{keyword:"\u30AD\u30E3\u30E9\u6027\u80FD\u6BD4\u8F03",id:"table1"},{keyword:"\u6B66\u5668\u65E9\u898B\u8868",id:"table2"},{keyword:"\u6226\u795E\u6027\u80FD\u6BD4\u8F03",id:"table3"}];M("dropArea",at);document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("openPage1");n&&n.addEventListener("click",ct)});function ct(){window.open(R.getTrainingPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("openPage2");n&&n.addEventListener("click",lt)});function lt(){window.open(R.getMinashigoSsrListPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("openPage3");n&&n.addEventListener("click",ut)});function ut(){window.open(R.getWeaponListPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("openPage4");n&&n.addEventListener("click",gt)});function gt(){window.open(R.getWarGoddessListPage(),"_blank")}document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("execute");n&&n.addEventListener("click",mt)});function mt(){let n=_({profile:new T,article:Q.value,tables:[Y.value,tt.value,et.value],tableNames:[rt.value,ot.value,it.value],maxOutput:parseInt(nt.value,10),isOutputComment:st.checked,captureMode:"CapturingGroups"});X.value=n}
//# sourceMappingURL=index.js.map